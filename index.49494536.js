!function(){function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function e(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,r)}}function r(r){return function(e){if(Array.isArray(e))return t(e)}(r)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||e(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}var o=new(function(){var t,o;function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"idle",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,i),this.initialState=t,this.gameStatus=e,this.gameScore=r,this.state=this.copyState(t)}return t=[{key:"copyState",value:function(t){return JSON.parse(JSON.stringify(t))}},{key:"toComapare",value:function(t,e){var r=this;return t.length===e.length&&t.every(function(t,n){if(Array.isArray(t)&&Array.isArray(e[n])){if(r.toComapare(t,e[n]))return!0}else if(t===e[n])return!0;return!1})}},{key:"setWinGame",value:function(t){2048===t&&(this.gameStatus="win",this.getStatus())}},{key:"isGameLoseVertical",value:function(){for(var t=this,e=function(e){for(var r=t.state.map(function(t){return t[e]}),n=0;n<r.length-1;n++)if(0===r[n]||r[n]===r[n+1])return{v:!1}},r=0;r<this.state.length;r++){var n=e(r);if("object"===a(n))return n.v}return!0}},{key:"isGameLoseHorizontal",value:function(){for(var t=0;t<this.state.length;t++)for(var e=0;e<this.state[t].length-1;e++){var r=this.state[t];if(0===r[e]||r[e]===r[e+1])return!1}return!0}},{key:"horizontalMoves",value:function(t){var e=this;if("idle"!==this.getStatus()){var r=this.copyState(this.state);this.state.map(function(r,n){for(var a=[],o=0;o<r.length;o++){var i=o+1;if(0===r[o]){i++;continue}0!==r[o]&&(i<r.length&&r[o]===r[i]&&(r[o]+=r[i],e.gameScore+=r[o],r[i]=0),a.push(r[o]))}for(;a.length<r.length;)"left"===t?a.push(0):a.unshift(0);e.state[n]=a}),this.toComapare(r,this.state)||this.addNumberAfterStep(),this.isGameLoseVertical()&&this.isGameLoseHorizontal()&&(this.gameStatus="lose",this.getStatus())}}},{key:"verticalMoves",value:function(t){var e=this;if("idle"!==this.getStatus()){var r=this.copyState(this.state),n=[];this.state.map(function(r,a){n=e.state.map(function(t){return t[a]});for(var o=[],i=0;i<n.length;i++){var s=i+1;if(0===n[i]){s++;continue}0!==n[i]&&(s<n.length&&n[i]===n[s]&&(n[i]+=n[s],e.gameScore+=n[i],n[s]=0),o.push(n[i]))}for(;o.length<n.length;)"up"===t?o.push(0):o.unshift(0);for(var u=0;u<e.state.length;u++)e.state[u][a]=o[u]}),this.toComapare(r,this.state)||this.addNumberAfterStep(),this.isGameLoseVertical()&&this.isGameLoseHorizontal()&&(this.gameStatus="lose",this.getStatus())}}},{key:"moveLeft",value:function(){this.horizontalMoves("left")}},{key:"moveRight",value:function(){this.horizontalMoves("right")}},{key:"moveUp",value:function(){this.verticalMoves("up")}},{key:"moveDown",value:function(){this.verticalMoves("down")}},{key:"getScore",value:function(){return this.gameScore}},{key:"getIndexes",value:function(){var t=this,e=[];this.state.forEach(function(r,n){r.forEach(function(r,a){t.setWinGame(r),0===r&&e.push([n,a])})});var r=Math.floor(Math.random()*e.length);return e[r]}},{key:"getNumber",value:function(){return .1>Math.random()?4:2}},{key:"renderFields",value:function(t){for(var n=this,o=[];o.length<t;){var i=function(){var e=r(n.getIndexes());return(o.some(function(t){return t.every(function(t,r){return t===e[r]})})&&2===t&&(e=r(n.getIndexes())),0>!e.length)?{v:void 0}:0!==n.state[e[0]][e[1]]?"break":void o.push(e)}();if("object"===a(i))return i.v;if("break"===i)break}var s=!0,u=!1,l=void 0;try{for(var c,f=o[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h,v=(h=c.value,function(t){if(Array.isArray(t))return t}(h)||function(t,e){var r,n,a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var o=[],i=!0,s=!1;try{for(a=a.call(t);!(i=(r=a.next()).done)&&(o.push(r.value),!e||o.length!==e);i=!0);}catch(t){s=!0,n=t}finally{try{i||null==a.return||a.return()}finally{if(s)throw n}}return o}}(h,2)||e(h,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),m=v[0],d=v[1];this.state[m][d]=this.getNumber()}}catch(t){u=!0,l=t}finally{try{s||null==f.return||f.return()}finally{if(u)throw l}}}},{key:"getState",value:function(){return this.state}},{key:"addNumberAfterStep",value:function(){this.renderFields(1)}},{key:"getStatus",value:function(){return this.gameStatus}},{key:"start",value:function(){this.renderFields(2),this.gameStatus="playing",this.getStatus()}},{key:"restart",value:function(){this.gameStatus="idle",this.state=this.copyState(this.initialState),this.gameScore=0}}],n(i.prototype,t),o&&n(i,o),i}());document.addEventListener("DOMContentLoaded",function(){var t=[[],[],[],[]],e=document.querySelector(".game-score"),n=document.querySelector(".button.start"),a=document.querySelector(".message-lose"),i=document.querySelector(".message-win"),s=document.querySelector(".message-start"),u=r(document.querySelectorAll(".field-row")),l=r(document.querySelectorAll(".field-row .field-cell")),c=function(){var e=r(l);u.forEach(function(r,n){t[n]=u[n],u.forEach(function(r,a){t[n][a]=e[a]}),e=e.slice(4)})},f=function(){o.state.forEach(function(e,r){e.forEach(function(e,n){t[r][n].textContent="",""===t[r][n].textContent&&(t[r][n].className="field-cell"),e>0&&(t[r][n].append(e),t[r][n].className="field-cell field-cell--".concat(e))})})};document.addEventListener("click",function(t){switch(t.srcElement.className){case"button start":o.start(),c(),f(),n.classList.remove("start"),n.classList.add("restart"),n.textContent="Restart",s.classList.add("hidden"),e.textContent=0;break;case"button restart":v(a,"lose"),v(i,"win"),e.textContent=0,o.restart(),o.start(),c(),f()}}),document.addEventListener("keydown",function(t){if("idle"!==o.gameStatus&&"win"!==o.gameStatus&&"lose"!==o.gameStatus)switch(t.key){case"ArrowLeft":o.moveLeft(),f(),e.textContent=o.getScore(),h(i,"win"),h(a,"lose");break;case"ArrowRight":o.moveRight(),f(),e.textContent=o.getScore(),h(i,"win"),h(a,"lose");break;case"ArrowUp":o.moveUp(),f(),e.textContent=o.getScore(),h(i,"win"),h(a,"lose");break;case"ArrowDown":o.moveDown(),f(),e.textContent=o.getScore(),h(i,"win"),h(a,"lose")}});var h=function(t,e){o.gameStatus===e&&t.classList.remove("hidden")},v=function(t,e){o.gameStatus===e&&t.classList.add("hidden")}})}();
//# sourceMappingURL=index.49494536.js.map
