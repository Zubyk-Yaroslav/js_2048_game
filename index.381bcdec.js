const t=new class{copyState(t){return JSON.parse(JSON.stringify(t))}constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],e="idle",s=0){this.initialState=t,this.gameStatus=e,this.gameScore=s,this.state=this.copyState(t)}toComapare(t,e){return t.length===e.length&&t.every((t,s)=>{if(Array.isArray(t)&&Array.isArray(e[s])){if(this.toComapare(t,e[s]))return!0}else if(t===e[s])return!0;return!1})}setWinGame(t){2048===t&&(this.gameStatus="win",this.getStatus())}isGameLoseVertical(){for(let t=0;t<this.state.length;t++){let e=this.state.map(e=>e[t]);for(let t=0;t<e.length-1;t++)if(0===e[t]||e[t]===e[t+1])return!1}return!0}isGameLoseHorizontal(){for(let t=0;t<this.state.length;t++)for(let e=0;e<this.state[t].length-1;e++){let s=this.state[t];if(0===s[e]||s[e]===s[e+1])return!1}return!0}horizontalMoves(t){if("idle"===this.getStatus())return;let e=this.copyState(this.state);this.state.map((e,s)=>{let a=[];for(let t=0;t<e.length;t++){let s=t+1;if(0===e[t]){s++;continue}0!==e[t]&&(s<e.length&&e[t]===e[s]&&(e[t]+=e[s],this.gameScore+=e[t],e[s]=0),a.push(e[t]))}for(;a.length<e.length;)"left"===t?a.push(0):a.unshift(0);this.state[s]=a}),this.toComapare(e,this.state)||this.addNumberAfterStep(),this.isGameLoseVertical()&&this.isGameLoseHorizontal()&&(this.gameStatus="lose",this.getStatus())}verticalMoves(t){if("idle"===this.getStatus())return;let e=this.copyState(this.state),s=[];this.state.map((e,a)=>{s=this.state.map(t=>t[a]);let r=[];for(let t=0;t<s.length;t++){let e=t+1;if(0===s[t]){e++;continue}0!==s[t]&&(e<s.length&&s[t]===s[e]&&(s[t]+=s[e],this.gameScore+=s[t],s[e]=0),r.push(s[t]))}for(;r.length<s.length;)"up"===t?r.push(0):r.unshift(0);for(let t=0;t<this.state.length;t++)this.state[t][a]=r[t]}),this.toComapare(e,this.state)||this.addNumberAfterStep(),this.isGameLoseVertical()&&this.isGameLoseHorizontal()&&(this.gameStatus="lose",this.getStatus())}moveLeft(){this.horizontalMoves("left")}moveRight(){this.horizontalMoves("right")}moveUp(){this.verticalMoves("up")}moveDown(){this.verticalMoves("down")}getScore(){return this.gameScore}getIndexes(){let t=[];this.state.forEach((e,s)=>{e.forEach((e,a)=>{this.setWinGame(e),0===e&&t.push([s,a])})});let e=Math.floor(Math.random()*t.length);return t[e]}getNumber(){return .1>Math.random()?4:2}renderFields(t){let e=[];for(;e.length<t;){let s=[...this.getIndexes()];if(e.some(t=>t.every((t,e)=>t===s[e]))&&2===t&&(s=[...this.getIndexes()]),0>!s.length)return;if(0!==this.state[s[0]][s[1]])break;e.push(s)}for(let[t,s]of e)this.state[t][s]=this.getNumber()}getState(){return this.state}addNumberAfterStep(){this.renderFields(1)}getStatus(){return this.gameStatus}start(){this.renderFields(2),this.gameStatus="playing",this.getStatus()}restart(){this.gameStatus="idle",this.state=this.copyState(this.initialState),this.gameScore=0}};document.addEventListener("DOMContentLoaded",()=>{let e=[[],[],[],[]],s=document.querySelector(".game-score"),a=document.querySelector(".button.start"),r=document.querySelector(".message-lose"),i=document.querySelector(".message-win"),o=document.querySelector(".message-start"),n=[...document.querySelectorAll(".field-row")],l=[...document.querySelectorAll(".field-row .field-cell")],h=()=>{let t=[...l];n.forEach((s,a)=>{e[a]=n[a],n.forEach((s,r)=>{e[a][r]=t[r]}),t=t.slice(4)})},c=()=>{t.state.forEach((t,s)=>{t.forEach((t,a)=>{e[s][a].textContent="",""===e[s][a].textContent&&(e[s][a].className="field-cell"),t>0&&(e[s][a].append(t),e[s][a].className=`field-cell field-cell--${t}`)})})};document.addEventListener("click",e=>{switch(e.srcElement.className){case"button start":t.start(),h(),c(),a.classList.remove("start"),a.classList.add("restart"),a.textContent="Restart",o.classList.add("hidden"),s.textContent=0;break;case"button restart":m(r,"lose"),m(i,"win"),s.textContent=0,t.restart(),t.start(),h(),c()}}),document.addEventListener("keydown",e=>{if("idle"!==t.gameStatus&&"win"!==t.gameStatus&&"lose"!==t.gameStatus)switch(e.key){case"ArrowLeft":t.moveLeft(),c(),s.textContent=t.getScore(),u(i,"win"),u(r,"lose");break;case"ArrowRight":t.moveRight(),c(),s.textContent=t.getScore(),u(i,"win"),u(r,"lose");break;case"ArrowUp":t.moveUp(),c(),s.textContent=t.getScore(),u(i,"win"),u(r,"lose");break;case"ArrowDown":t.moveDown(),c(),s.textContent=t.getScore(),u(i,"win"),u(r,"lose")}});let u=(e,s)=>{t.gameStatus===s&&e.classList.remove("hidden")},m=(e,s)=>{t.gameStatus===s&&e.classList.add("hidden")}});
//# sourceMappingURL=index.381bcdec.js.map
